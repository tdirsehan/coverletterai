<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Academic Cover Letter Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            min-height: 100vh !important;
            padding: 20px !important;
            margin: 0 !important;
        }

        .container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            background: rgba(255, 255, 255, 0.95) !important;
            border-radius: 20px !important;
            padding: 30px !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
            backdrop-filter: blur(10px) !important;
        }

        h1 {
            text-align: center !important;
            color: #333 !important;
            margin-bottom: 10px !important;
            font-size: 2.5em !important;
            background: linear-gradient(45deg, #667eea, #764ba2) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            font-weight: bold !important;
        }

        .subtitle {
            text-align: center !important;
            color: #666 !important;
            margin-bottom: 30px !important;
            font-size: 1.1em !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 10px !important;
        }

        .ai-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24) !important;
            color: white !important;
            padding: 4px 12px !important;
            border-radius: 20px !important;
            font-size: 0.8em !important;
            font-weight: bold !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            animation: pulse 2s infinite !important;
            display: inline-block !important;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .ai-config {
            background: rgba(255, 107, 107, 0.1) !important;
            border: 2px solid rgba(255, 107, 107, 0.3) !important;
            border-radius: 15px !important;
            padding: 20px !important;
            margin-bottom: 30px !important;
        }

        .ai-config h3 {
            color: #ee5a24 !important;
            margin-bottom: 15px !important;
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            font-weight: bold !important;
        }

        .api-options {
            display: grid !important;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important;
            gap: 15px !important;
            margin-bottom: 20px !important;
        }

        .api-option {
            background: rgba(255, 255, 255, 0.8) !important;
            border: 2px solid #e1e5e9 !important;
            border-radius: 10px !important;
            padding: 15px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            margin-bottom: 10px !important;
        }

        .api-option:hover {
            border-color: #667eea !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2) !important;
        }

        .api-option.selected {
            border-color: #ff6b6b !important;
            background: rgba(255, 107, 107, 0.1) !important;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.2) !important;
        }

        .api-option h4 {
            color: #333 !important;
            margin-bottom: 8px !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
            font-weight: bold !important;
        }

        .api-option p {
            color: #666 !important;
            font-size: 0.9em !important;
            margin-bottom: 8px !important;
        }

        .api-status {
            font-size: 0.8em !important;
            font-weight: bold !important;
        }

        .status-free { 
            color: #28a745 !important; 
            font-weight: bold !important;
        }

        .form-grid {
            display: grid !important;
            grid-template-columns: 1fr 1fr 1fr !important;
            gap: 25px !important;
            margin-bottom: 30px !important;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.8) !important;
            padding: 25px !important;
            border-radius: 15px !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05) !important;
            margin-bottom: 20px !important;
        }

        .form-section h2 {
            color: #555 !important;
            margin-bottom: 20px !important;
            font-size: 1.3em !important;
            border-bottom: 2px solid #667eea !important;
            padding-bottom: 10px !important;
            font-weight: bold !important;
        }

        .form-group {
            margin-bottom: 20px !important;
        }

        label {
            display: block !important;
            margin-bottom: 8px !important;
            font-weight: 600 !important;
            color: #444 !important;
            font-size: 0.95em !important;
        }

        input, textarea, select {
            width: 100% !important;
            padding: 12px 15px !important;
            border: 2px solid #e1e5e9 !important;
            border-radius: 10px !important;
            font-size: 14px !important;
            transition: all 0.3s ease !important;
            background: rgba(255, 255, 255, 0.9) !important;
            font-family: inherit !important;
        }

        input:focus, textarea:focus, select:focus {
            outline: none !important;
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
            transform: translateY(-2px) !important;
        }

        textarea {
            resize: vertical !important;
            min-height: 100px !important;
            font-family: inherit !important;
        }

        .large-textarea {
            min-height: 150px !important;
        }

        .generate-section {
            display: flex !important;
            gap: 15px !important;
            margin-bottom: 30px !important;
        }

        .generate-btn {
            flex: 1 !important;
            padding: 15px !important;
            border: none !important;
            border-radius: 12px !important;
            font-size: 18px !important;
            font-weight: 600 !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            text-transform: uppercase !important;
            letter-spacing: 1px !important;
            margin: 5px !important;
        }

        .ai-generate {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24) !important;
            color: white !important;
        }

        .template-generate {
            background: linear-gradient(45deg, #667eea, #764ba2) !important;
            color: white !important;
        }

        .generate-btn:hover:not(:disabled) {
            transform: translateY(-3px) !important;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2) !important;
        }

        .generate-btn:disabled {
            opacity: 0.6 !important;
            cursor: not-allowed !important;
            transform: none !important;
        }

        .loading {
            position: relative !important;
            overflow: hidden !important;
        }

        .loading::after {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: -100% !important;
            width: 100% !important;
            height: 100% !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
            animation: loading 1.5s infinite !important;
        }

        @keyframes loading {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .output-section {
            background: rgba(255, 255, 255, 0.9) !important;
            padding: 30px !important;
            border-radius: 15px !important;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05) !important;
        }

        .output-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: center !important;
            margin-bottom: 20px !important;
        }

        .output-header h2 {
            color: #555 !important;
            font-size: 1.4em !important;
        }

        .generation-type {
            padding: 5px 15px !important;
            border-radius: 20px !important;
            font-size: 0.8em !important;
            font-weight: bold !important;
            text-transform: uppercase !important;
        }

        .ai-generated {
            background: #ff6b6b !important;
            color: white !important;
        }

        .template-generated {
            background: #667eea !important;
            color: white !important;
        }

        .copy-btn {
            padding: 10px 20px !important;
            background: #28a745 !important;
            color: white !important;
            border: none !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            font-weight: 600 !important;
            transition: all 0.3s ease !important;
        }

        .copy-btn:hover {
            background: #218838 !important;
            transform: translateY(-2px) !important;
        }

        .output-text {
            background: #f8f9fa !important;
            padding: 25px !important;
            border-radius: 10px !important;
            border-left: 4px solid #667eea !important;
            font-family: 'Georgia', serif !important;
            line-height: 1.8 !important;
            color: #333 !important;
            white-space: pre-wrap !important;
            min-height: 400px !important;
            font-size: 14px !important;
        }

        .word-count {
            text-align: right !important;
            margin-top: 10px !important;
            color: #666 !important;
            font-size: 0.9em !important;
        }

        .placeholder-hint {
            font-size: 0.85em !important;
            color: #666 !important;
            margin-top: 5px !important;
            font-style: italic !important;
        }

        .api-setup {
            background: rgba(102, 126, 234, 0.1) !important;
            border: 1px solid rgba(102, 126, 234, 0.3) !important;
            border-radius: 10px !important;
            padding: 15px !important;
            margin-top: 15px !important;
            font-size: 0.9em !important;
        }

        .setup-link {
            color: #667eea !important;
            background: none !important;
            border: none !important;
            font-weight: bold !important;
            cursor: pointer !important;
            text-decoration: underline !important;
            font-size: inherit !important;
            font-family: inherit !important;
        }

        .setup-link:hover {
            color: #5a6fd8 !important;
            text-decoration: none !important;
        }

        .api-validation {
            padding: 10px !important;
            border-radius: 8px !important;
            font-size: 0.9em !important;
            font-weight: 600 !important;
            margin-top: 10px !important;
        }

        .validation-status {
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }

        .status-validating {
            background: rgba(255, 193, 7, 0.1) !important;
            border: 1px solid #ffc107 !important;
            color: #856404 !important;
        }

        .status-valid {
            background: rgba(40, 167, 69, 0.1) !important;
            border: 1px solid #28a745 !important;
            color: #155724 !important;
        }

        .status-invalid {
            background: rgba(220, 53, 69, 0.1) !important;
            border: 1px solid #dc3545 !important;
            color: #721c24 !important;
        }

        .status-spinner {
            width: 16px !important;
            height: 16px !important;
            border: 2px solid #ffc107 !important;
            border-top: 2px solid transparent !important;
            border-radius: 50% !important;
            animation: spin 1s linear infinite !important;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .important-notice {
            background: rgba(255, 193, 7, 0.1) !important;
            border: 2px solid #ffc107 !important;
            border-radius: 15px !important;
            padding: 20px !important;
            margin-top: 30px !important;
            font-size: 0.95em !important;
            display: none !important;
        }

        .notice-header {
            display: flex !important;
            align-items: center !important;
            gap: 10px !important;
            margin-bottom: 15px !important;
            color: #856404 !important;
            font-size: 1.1em !important;
        }

        .notice-icon {
            font-size: 1.2em !important;
        }

        .important-notice p {
            margin-bottom: 12px !important;
            color: #856404 !important;
            line-height: 1.6 !important;
        }

        .important-notice ul {
            margin: 15px 0 15px 20px !important;
            color: #856404 !important;
        }

        .important-notice li {
            margin-bottom: 8px !important;
            line-height: 1.5 !important;
        }

        .important-notice em {
            color: #6c5700 !important;
            font-weight: 600 !important;
        }

        @media (max-width: 1024px) {
            .form-grid {
                grid-template-columns: 1fr 1fr !important;
            }
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr !important;
            }
            
            .container {
                padding: 20px !important;
            }
            
            h1 {
                font-size: 2em !important;
            }

            .generate-section {
                flex-direction: column !important;
            }

            .api-options {
                grid-template-columns: 1fr !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>AI-Powered Cover Letter Generator</h1>
        <div class="subtitle">
            <span class="ai-badge">Real AI Integration</span>
            <span>Free ‚Ä¢ Powerful ‚Ä¢ Intelligent</span>
        </div>
        
        <div class="ai-config">
            <h3>ü§ñ AI Provider Selection</h3>
            <div class="api-options">
                <div class="api-option selected" data-provider="gemini">
                    <h4>üíé Google Gemini</h4>
                    <p>Google's powerful AI with generous free tier</p>
                    <div class="api-status status-free">‚úÖ Free Tier: 15 requests/minute</div>
                </div>
                <div class="api-option" data-provider="huggingface">
                    <h4>ü§ó Hugging Face</h4>
                    <p>Open-source models with free inference API</p>
                    <div class="api-status status-free">‚úÖ Free Tier: 1000 requests/month</div>
                </div>
                <div class="api-option" data-provider="together">
                    <h4>üöÄ Together AI</h4>
                    <p>Fast, reliable, and completely free tier available</p>
                    <div class="api-status status-free">‚úÖ Free Tier: 1M tokens/month</div>
                </div>
                <div class="api-option" data-provider="groq">
                    <h4>‚ö° Groq</h4>
                    <p>Ultra-fast inference with generous free limits</p>
                    <div class="api-status status-free">‚úÖ Free Tier: Very generous</div>
                </div>
                <div class="api-option" data-provider="deepseek">
                    <h4>üß† DeepSeek</h4>
                    <p>High-quality models with free access</p>
                    <div class="api-status status-free">‚úÖ Free Tier: Available</div>
                </div>
                <div class="api-option" data-provider="template">
                    <h4>üìù Template Mode</h4>
                    <p>No AI - uses smart template system</p>
                    <div class="api-status status-free">‚úÖ Always Free</div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="apiKey">API Key (Optional):</label>
                <input type="password" id="apiKey" placeholder="Enter your API key for unlimited access">
                <div class="placeholder-hint">Leave blank to use template mode. Format validation only - actual functionality tested during generation.</div>
                <div class="api-validation" id="apiValidation" style="display: none;">
                    <div class="validation-status" id="validationStatus"></div>
                </div>
            </div>
            
            <div class="api-setup">
                <strong>Quick Setup:</strong> 
                <button class="setup-link" onclick="showSetupInstructions()">Click here for free API key setup instructions</button>
            </div>
        </div>
        
        <div class="form-grid">
            <div class="form-section">
                <h2>Author Information</h2>
                <div class="form-group">
                    <label for="authors">Authors:</label>
                    <input type="text" id="authors" placeholder="List all authors (e.g., John Smith, Jane Doe, Robert Johnson)">
                </div>
                
                <div class="form-group">
                    <label for="corresponding">Corresponding Author (on behalf of the authors):</label>
                    <input type="text" id="corresponding-main" placeholder="Enter the corresponding author's full name">
                    <div class="placeholder-hint">This will be used for the signature at the end of the cover letter</div>
                </div>
                
                <div class="form-group">
                    <label for="correspondingTitle">Corresponding Author Title/Position:</label>
                    <input type="text" id="correspondingTitle" placeholder="e.g., Professor, Associate Professor, Research Scientist">
                </div>
                
                <div class="form-group">
                    <label for="affiliation">Institution/Affiliation:</label>
                    <input type="text" id="affiliation" placeholder="University or institution name">
                </div>
                
                <div class="form-group">
                    <label for="contactEmail">Contact Email:</label>
                    <input type="email" id="contactEmail" placeholder="corresponding.author@university.edu">
                </div>
            </div>
            
            <div class="form-section">
                <h2>Manuscript Information</h2>
                <div class="form-group">
                    <label for="title">Manuscript Title:</label>
                    <input type="text" id="title" placeholder="Enter your manuscript title">
                </div>
                
                <div class="form-group">
                    <label for="manuscriptType">Manuscript Type:</label>
                    <select id="manuscriptType">
                        <option value="original">Original Research Paper</option>
                        <option value="review">Review Article</option>
                        <option value="letter">Letter/Brief Communication</option>
                        <option value="case-study">Case Study</option>
                        <option value="perspective">Perspective/Opinion</option>
                        <option value="editorial">Editorial</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="abstract">Abstract/Research Summary:</label>
                    <textarea id="abstract" class="large-textarea" placeholder="Paste your manuscript abstract here"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="keywords">Keywords:</label>
                    <input type="text" id="keywords" placeholder="keyword1, keyword2, keyword3">
                    <div class="placeholder-hint">Separate keywords with commas</div>
                </div>
                
                <div class="form-group">
                    <label for="wordCount">Word Count:</label>
                    <input type="number" id="wordCount" placeholder="e.g., 5000">
                </div>
            </div>
            
            <div class="form-section">
                <h2>Journal & Editor Information</h2>
                <div class="form-group">
                    <label for="journal">Journal Name:</label>
                    <input type="text" id="journal" placeholder="Enter the target journal name">
                </div>
                
                <div class="form-group">
                    <label for="editor">Target Editor:</label>
                    <input type="text" id="editor" placeholder="Dr. [Editor's Full Name] or 'Dear Editor' if unknown">
                </div>
                
                <div class="form-group">
                    <label for="scope">Journal Aims & Scope:</label>
                    <textarea id="scope" class="large-textarea" placeholder="Paste the journal's aims and scope description"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="specialIssue">Special Issue (if applicable):</label>
                    <input type="text" id="specialIssue" placeholder="Leave blank if not for a special issue">
                </div>
                
                <div class="form-group">
                    <label for="letterLength">Letter Length:</label>
                    <select id="letterLength">
                        <option value="standard">Standard (~500 words)</option>
                        <option value="short">Short (~300 words)</option>
                        <option value="long">Long (~750 words)</option>
                    </select>
                </div>
            </div>
            
            <div class="form-section">
                <h2>Research Significance & Impact</h2>
                <div class="form-group">
                    <label for="researchAims">Primary Research Aims/Problem Addressed:</label>
                    <textarea id="researchAims" placeholder="What problem does your research address? What are the main objectives?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="keyFindings">Key Findings/Results:</label>
                    <textarea id="keyFindings" placeholder="What are your most significant findings? What did you discover?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="significance">Why This Work is Important:</label>
                    <textarea id="significance" placeholder="Why does this work matter? What is its potential impact or applications?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="novelty">What This Manuscript Adds:</label>
                    <textarea id="novelty" placeholder="How does this contribute to existing literature? What makes it novel?"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="takeHome">Take-Home Message:</label>
                    <textarea id="takeHome" placeholder="What is the main message readers should remember?"></textarea>
                </div>
            </div>
            
            <div class="form-section">
                <h2>Declarations & Statements</h2>
                <div class="form-group">
                    <label for="fundingSource">Funding Sources:</label>
                    <textarea id="fundingSource" placeholder="List funding sources or state 'No funding received'"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="conflictInterest">Conflicts of Interest:</label>
                    <textarea id="conflictInterest" placeholder="Declare any conflicts of interest or state 'No conflicts of interest'"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="ethicalApproval">Ethical Approval:</label>
                    <textarea id="ethicalApproval" placeholder="IRB approval, consent information, or state 'Not applicable'"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="aiUsage">AI Tool Usage:</label>
                    <select id="aiUsage">
                        <option value="none">No AI tools used</option>
                        <option value="language">Used for language refinement/grammar checking only</option>
                        <option value="analysis">Used for data analysis assistance</option>
                        <option value="writing">Used for writing assistance</option>
                        <option value="other">Other AI assistance</option>
                    </select>
                    <div class="placeholder-hint">Declaration of AI tool usage is increasingly required by journals</div>
                </div>
                
                <div class="form-group">
                    <label for="priorPresentation">Prior Presentations:</label>
                    <input type="text" id="priorPresentation" placeholder="Conference presentations or leave blank if none">
                </div>
            </div>
            
            <div class="form-section">
                <h2>Additional Information (Optional)</h2>
                <div class="form-group">
                    <label for="suggestedReviewers">Suggested Reviewers:</label>
                    <textarea id="suggestedReviewers" placeholder="Name, Institution, Email (avoid colleagues/collaborators)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="excludedReviewers">Reviewers to Exclude:</label>
                    <textarea id="excludedReviewers" placeholder="Names and reasons for exclusion"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="priorCommunication">Prior Communication with Journal:</label>
                    <textarea id="priorCommunication" placeholder="Any previous correspondence or interactions"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="additionalComments">Additional Comments/Requests:</label>
                    <textarea id="additionalComments" placeholder="Any special requests or additional information"></textarea>
                </div>
            </div>
        </div>
        
        <div class="generate-section">
            <button class="generate-btn ai-generate" onclick="generateAICoverLetter()">
                ü§ñ Generate with AI
            </button>
            <button class="generate-btn template-generate" onclick="generateTemplateCoverLetter()">
                üìù Generate with Template
            </button>
        </div>
        
        <div class="output-section">
            <div class="output-header">
                <h2>Generated Cover Letter</h2>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <span class="generation-type template-generated" id="generationType">Template</span>
                    <button class="copy-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
                </div>
            </div>
            <div class="output-text" id="output">Your generated cover letter will appear here...</div>
            <div class="word-count" id="wordCount">Word count: 0</div>
            
            <div class="important-notice" id="importantNotice">
                <div class="notice-header">
                    <span class="notice-icon">‚ö†Ô∏è</span>
                    <strong>Important Notice</strong>
                </div>
                <p><strong>Please carefully review and modify the generated cover letter before submission.</strong> While our AI and template systems create professional academic cover letters, you should:</p>
                <ul>
                    <li>Read the entire letter thoroughly</li>
                    <li>Verify all information is accurate and relevant</li>
                    <li>Adjust the tone and content to match your research</li>
                    <li>Ensure proper alignment with the target journal</li>
                    <li>Personalize sections to reflect your specific contributions</li>
                </ul>
                <p><em>This tool provides a starting point - final responsibility for content accuracy and appropriateness lies with the user.</em></p>
            </div>
        </div>
    </div>

    <script>
        let selectedProvider = 'gemini';
        let selectedLength = 'standard';
        let validationTimeout = null;

        // Provider selection handling
        document.querySelectorAll('.api-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.api-option').forEach(opt => opt.classList.remove('selected'));
                this.classList.add('selected');
                selectedProvider = this.dataset.provider;
                
                // Re-validate API key when provider changes
                const apiKey = document.getElementById('apiKey').value.trim();
                if (apiKey && selectedProvider !== 'template') {
                    validateApiKey(apiKey);
                } else {
                    hideValidation();
                }
            });
        });

        // Length selection handling
        document.getElementById('letterLength').addEventListener('change', function(e) {
            selectedLength = e.target.value;
        });

        // API key validation with proper debouncing
        document.getElementById('apiKey').addEventListener('input', function(e) {
            const apiKey = e.target.value.trim();
            
            // Clear previous timeout
            if (validationTimeout) {
                clearTimeout(validationTimeout);
            }
            
            if (!apiKey) {
                hideValidation();
                return;
            }
            
            if (selectedProvider === 'template') {
                hideValidation();
                return;
            }
            
            // Show validating status immediately
            showValidationStatus('validating', 'üîÑ Validating API key...', true);
            
            // Debounce validation (wait 1.5 seconds after user stops typing)
            validationTimeout = setTimeout(() => {
                validateApiKey(apiKey);
            }, 1500);
        });

        // Show setup instructions
        function showSetupInstructions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0,0,0,0.2);
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            `;
            
            content.innerHTML = `
                <h2 style="color: #333; margin-bottom: 20px; text-align: center;">üöÄ Free AI API Setup Guide</h2>
                
                <div style="margin-bottom: 25px; padding: 15px; background: #e8f5e8; border-radius: 10px; border-left: 4px solid #28a745;">
                    <h3 style="color: #155724; margin-bottom: 10px;">üíé Google Gemini (Recommended)</h3>
                    <p style="margin-bottom: 10px;"><strong>Best option:</strong> 15 requests/minute, 1500/day</p>
                    <ol style="margin-left: 20px; line-height: 1.6;">
                        <li>Go to: <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #667eea;">aistudio.google.com/app/apikey</a></li>
                        <li>Sign in with your Google account</li>
                        <li>Click "Create API Key"</li>
                        <li>Copy the key and paste it above</li>
                    </ol>
                    <p style="margin-top: 10px; font-weight: bold; color: #28a745;">‚úÖ NO CREDIT CARD REQUIRED!</p>
                </div>
                
                <div style="margin-bottom: 25px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #856404;">
                    <h3 style="color: #856404; margin-bottom: 10px;">ü§ó Hugging Face</h3>
                    <p style="margin-bottom: 10px;"><strong>Great for variety:</strong> 1000 requests/month, many models</p>
                    <ol style="margin-left: 20px; line-height: 1.6;">
                        <li>Go to: <a href="https://huggingface.co/settings/tokens" target="_blank" style="color: #667eea;">huggingface.co/settings/tokens</a></li>
                        <li>Sign up for free account</li>
                        <li>Create new token with "Inference API" permission</li>
                        <li>Copy the token and paste it above</li>
                    </ol>
                </div>
                
                <button onclick="this.parentElement.parentElement.remove()" style="
                    width: 100%;
                    padding: 12px;
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 16px;
                    font-weight: 600;
                    cursor: pointer;
                    text-transform: uppercase;
                    letter-spacing: 1px;
                ">Close Instructions</button>
            `;
            
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            // Close on background click
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        // Simplified API Key Validation
        function validateApiKey(apiKey) {
            if (selectedProvider === 'template' || !apiKey) {
                hideValidation();
                return;
            }
            
            // Simple validation that just checks if the key looks valid
            let isValidFormat = false;
            let message = '';
            
            switch(selectedProvider) {
                case 'gemini':
                    isValidFormat = apiKey.startsWith('AIza') && apiKey.length > 20;
                    message = isValidFormat ? '‚úÖ Gemini API key format is correct' : '‚ùå Gemini keys should start with "AIza" and be longer';
                    break;
                case 'huggingface':
                    isValidFormat = apiKey.startsWith('hf_') && apiKey.length > 10;
                    message = isValidFormat ? '‚úÖ Hugging Face API key format is correct' : '‚ùå Hugging Face keys should start with "hf_"';
                    break;
                case 'together':
                case 'groq':
                case 'deepseek':
                    isValidFormat = apiKey.length > 15;
                    message = isValidFormat ? '‚úÖ API key format looks correct' : '‚ùå API key seems too short';
                    break;
                default:
                    isValidFormat = apiKey.length > 5;
                    message = isValidFormat ? '‚úÖ API key format looks correct' : '‚ùå API key seems too short';
            }
            
            if (isValidFormat) {
                showValidationStatus('valid', message + ' - Ready to test with generation');
            } else {
                showValidationStatus('invalid', message);
            }
        }

        function showValidationStatus(type, message, showSpinner = false) {
            const validation = document.getElementById('apiValidation');
            const status = document.getElementById('validationStatus');
            
            validation.style.display = 'block';
            validation.className = `api-validation status-${type}`;
            
            if (showSpinner) {
                status.innerHTML = `<div class="status-spinner"></div><span>${message}</span>`;
            } else {
                status.innerHTML = message;
            }
        }

        function hideValidation() {
            const validation = document.getElementById('apiValidation');
            validation.style.display = 'none';
        }

        // AI Cover Letter Generation
        async function generateAICoverLetter() {
            if (!validateForm()) return;
            
            const aiBtn = document.querySelector('.ai-generate');
            aiBtn.disabled = true;
            aiBtn.classList.add('loading');
            aiBtn.textContent = 'ü§ñ Generating with AI...';
            
            try {
                if (selectedProvider === 'template') {
                    generateTemplateCoverLetter();
                    return;
                }
                
                const prompt = createAIPrompt();
                const aiResponse = await callAI(prompt);
                
                if (aiResponse && aiResponse.trim()) {
                    document.getElementById('output').textContent = aiResponse;
                    document.getElementById('generationType').textContent = 'AI Generated';
                    document.getElementById('generationType').className = 'generation-type ai-generated';
                    updateWordCount();
                    showImportantNotice();
                } else {
                    throw new Error('Empty AI response');
                }
                
            } catch (error) {
                console.log('AI generation failed:', error.message);
                // Fallback to template
                generateTemplateCoverLetterInternal();
                
                if (error.message.includes('API key')) {
                    alert('API key issue. Generated using template instead. Try getting a free API key for AI generation.');
                } else if (error.message.includes('quota') || error.message.includes('limit')) {
                    alert('API quota exceeded. Generated using template instead. Try a different provider or get an API key.');
                } else {
                    alert('AI service temporarily unavailable. Generated using template instead.');
                }
            } finally {
                aiBtn.disabled = false;
                aiBtn.classList.remove('loading');
                aiBtn.textContent = 'ü§ñ Generate with AI';
            }
        }

        // Create AI prompt - enhanced with comprehensive information
        function createAIPrompt() {
            const formData = {
                title: document.getElementById('title').value,
                authors: document.getElementById('authors').value,
                corresponding: document.getElementById('corresponding-main').value,
                correspondingTitle: document.getElementById('correspondingTitle').value,
                affiliation: document.getElementById('affiliation').value,
                contactEmail: document.getElementById('contactEmail').value,
                manuscriptType: document.getElementById('manuscriptType').value,
                abstract: document.getElementById('abstract').value,
                keywords: document.getElementById('keywords').value,
                wordCount: document.getElementById('wordCount').value,
                journal: document.getElementById('journal').value,
                editor: document.getElementById('editor').value,
                scope: document.getElementById('scope').value,
                specialIssue: document.getElementById('specialIssue').value,
                researchAims: document.getElementById('researchAims').value,
                keyFindings: document.getElementById('keyFindings').value,
                significance: document.getElementById('significance').value,
                novelty: document.getElementById('novelty').value,
                takeHome: document.getElementById('takeHome').value,
                fundingSource: document.getElementById('fundingSource').value,
                conflictInterest: document.getElementById('conflictInterest').value,
                ethicalApproval: document.getElementById('ethicalApproval').value,
                aiUsage: document.getElementById('aiUsage').value,
                priorPresentation: document.getElementById('priorPresentation').value,
                suggestedReviewers: document.getElementById('suggestedReviewers').value,
                excludedReviewers: document.getElementById('excludedReviewers').value,
                priorCommunication: document.getElementById('priorCommunication').value,
                additionalComments: document.getElementById('additionalComments').value
            };
            
            const lengthGuide = {
                short: 'approximately 300 words',
                standard: 'approximately 500 words', 
                long: 'approximately 750 words'
            };
            
            return `Write a comprehensive professional academic cover letter (${lengthGuide[selectedLength]}) following best practices for journal submission:

AUTHOR INFORMATION:
- Authors: ${formData.authors}
- Corresponding Author: ${formData.corresponding}, ${formData.correspondingTitle}
- Affiliation: ${formData.affiliation}
- Contact: ${formData.contactEmail}

MANUSCRIPT DETAILS:
- Title: "${formData.title}"
- Type: ${formData.manuscriptType}
- Keywords: ${formData.keywords}
- Word Count: ${formData.wordCount}
- Abstract: ${formData.abstract}

TARGET JOURNAL:
- Journal: ${formData.journal}
- Editor: ${formData.editor}
- Journal Scope: ${formData.scope}
- Special Issue: ${formData.specialIssue || 'Not applicable'}

RESEARCH SIGNIFICANCE:
- Research Aims: ${formData.researchAims}
- Key Findings: ${formData.keyFindings}
- Significance: ${formData.significance}
- Novelty/Contribution: ${formData.novelty}
- Take-Home Message: ${formData.takeHome}

DECLARATIONS:
- Funding: ${formData.fundingSource}
- Conflicts of Interest: ${formData.conflictInterest}
- Ethics: ${formData.ethicalApproval}
- AI Usage: ${formData.aiUsage}
- Prior Presentations: ${formData.priorPresentation || 'None'}

ADDITIONAL INFORMATION:
- Prior Communication: ${formData.priorCommunication || 'None'}
- Additional Comments: ${formData.additionalComments || 'None'}

REQUIREMENTS:
- Address editor formally by name
- Highlight manuscript significance and novelty
- Connect research to journal's scope and mission
- Include all necessary declarations
- Emphasize relevance to readership
- Use professional academic tone
- Include proper structure and closing
- Target length: ${lengthGuide[selectedLength]}

Generate ONLY the cover letter text, starting with "Dear ${formData.editor}," and ending with the signature.`;
        }

        // Call AI API
        async function callAI(prompt) {
            const apiKey = document.getElementById('apiKey').value;
            
            if (!apiKey) {
                throw new Error('API key required');
            }
            
            // API configurations for different providers
            const configs = {
                gemini: {
                    url: `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`,
                    payload: {
                        contents: [{
                            parts: [{
                                text: `You are an expert academic writing assistant. ${prompt}`
                            }]
                        }],
                        generationConfig: {
                            maxOutputTokens: selectedLength === 'short' ? 400 : selectedLength === 'long' ? 900 : 650,
                            temperature: 0.7
                        }
                    }
                },
                huggingface: {
                    url: 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-large',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    payload: {
                        inputs: prompt,
                        parameters: {
                            max_new_tokens: selectedLength === 'short' ? 400 : selectedLength === 'long' ? 900 : 650,
                            temperature: 0.7,
                            return_full_text: false
                        }
                    }
                }
            };
            
            const config = configs[selectedProvider];
            if (!config) {
                throw new Error('Provider not supported for AI generation');
            }
            
            const headers = {
                'Content-Type': 'application/json',
                ...(config.headers || {})
            };
            
            try {
                const response = await fetch(config.url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(config.payload)
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid API key');
                    } else if (response.status === 429) {
                        throw new Error('API quota exceeded');
                    } else {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                }
                
                const data = await response.json();
                
                // Handle different response formats
                if (selectedProvider === 'gemini') {
                    return data.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || '';
                } else if (selectedProvider === 'huggingface') {
                    return data.generated_text?.trim() || data[0]?.generated_text?.trim() || '';
                }
                
                return '';
                
            } catch (networkError) {
                if (networkError.message.includes('fetch')) {
                    throw new Error('Network connection failed');
                }
                throw networkError;
            }
        }

        // Template generation (main button)
        function generateTemplateCoverLetter() {
            if (!validateForm()) return;
            
            const templateBtn = document.querySelector('.template-generate');
            templateBtn.disabled = true;
            templateBtn.classList.add('loading');
            templateBtn.textContent = 'üìù Generating Template...';
            
            setTimeout(() => {
                generateTemplateCoverLetterInternal();
                
                templateBtn.disabled = false;
                templateBtn.classList.remove('loading');
                templateBtn.textContent = 'üìù Generate with Template';
            }, 1000);
        }

        // Internal template generation (used by both buttons)
        function generateTemplateCoverLetterInternal() {
            const coverLetter = generateTemplateContent();
            document.getElementById('output').textContent = coverLetter;
            document.getElementById('generationType').textContent = 'Template';
            document.getElementById('generationType').className = 'generation-type template-generated';
            updateWordCount();
            showImportantNotice();
        }

        // Generate template content
        function generateTemplateContent() {
            const title = document.getElementById('title').value;
            const authors = document.getElementById('authors').value;
            const journal = document.getElementById('journal').value;
            const editor = document.getElementById('editor').value;
            const corresponding = document.getElementById('corresponding-main').value;
            
            if (selectedLength === 'short') {
                return generateShortTemplate(title, authors, journal, editor, corresponding);
            } else if (selectedLength === 'long') {
                return generateLongTemplate(title, authors, journal, editor, corresponding);
            } else {
                return generateStandardTemplate(title, authors, journal, editor, corresponding);
            }
        }

        function generateShortTemplate(title, authors, journal, editor, corresponding) {
            return `Dear ${editor},

I am writing to submit our manuscript entitled "${title}" for consideration for publication in ${journal}. This manuscript represents original research conducted by ${authors} and aligns with the journal's mission.

Our research addresses critical gaps in current understanding while employing rigorous methodology. The findings reveal significant insights with important implications for both theoretical advancement and practical applications within the field. This work contributes meaningfully to the body of knowledge that ${journal} seeks to advance.

The manuscript's relevance to ${journal}'s readership stems from its innovative approach and actionable insights. Our methodology addresses key limitations identified in previous studies while introducing elements that advance the field's methodological foundation.

We believe this research embodies the type of scholarship that ${journal} consistently publishes and will generate significant interest among your readership.

Thank you for your consideration.

Sincerely,

${corresponding}`;
        }

        function generateStandardTemplate(title, authors, journal, editor, corresponding) {
            return `Dear ${editor},

I am writing to submit our manuscript entitled "${title}" for consideration for publication in ${journal}. This manuscript represents original research conducted by ${authors}, and I believe it aligns exceptionally well with the journal's mission and will be of significant interest to your readership.

The research presented in our manuscript directly corresponds to ${journal}'s aims and scope. Our study addresses critical aspects outlined in your journal's mission, particularly focusing on areas that fall squarely within ${journal}'s editorial focus. The methodology and findings we present contribute meaningfully to the body of knowledge that ${journal} seeks to advance.

Our manuscript makes several novel contributions to the field. The research addresses an important gap in current understanding, as evidenced by our comprehensive investigation. Our methodological approach represents an innovative framework for examining the research problem, employing rigorous analytical techniques that ensure robust and reliable results.

The significance of this work extends beyond its immediate findings. Our research tackles a critical issue that has been identified as a priority area within the relevant academic community. The theoretical framework we develop provides a solid foundation for future research, while the practical implications of our findings offer substantial value to both researchers and practitioners.

The methodological rigor of our study deserves particular emphasis. We employed a carefully designed research approach that addresses key limitations identified in previous studies. Our analytical strategy incorporates multiple validation methods and comprehensive data sources, lending credibility and generalizability to our conclusions.

The relevance of this research to ${journal}'s readership cannot be overstated. Scholars working in related fields will find our results directly applicable to their research endeavors. The implications we discuss extend across multiple domains, ensuring broad appeal within the journal's academic community.

From a practical standpoint, our findings offer actionable insights for relevant stakeholders and practitioners. The evidence-based guidance we provide can inform policy development, professional practice, and decision-making processes.

We believe that the combination of theoretical contribution, methodological innovation, and practical relevance makes our manuscript an ideal fit for ${journal}. The research addresses fundamental questions while providing actionable insights, embodying the type of scholarship that ${journal} consistently publishes.

We appreciate your consideration of our manuscript and look forward to your response.

Sincerely,

${corresponding}`;
        }

        function generateLongTemplate(title, authors, journal, editor, corresponding) {
            return `Dear ${editor},

I am writing to submit our manuscript entitled "${title}" for consideration for publication in ${journal}. This manuscript represents original research conducted by ${authors}, and I believe it aligns exceptionally well with the journal's mission and will be of significant interest to your readership.

The research presented in our manuscript directly corresponds to ${journal}'s aims and scope. Our study addresses critical aspects outlined in your journal's mission, particularly focusing on areas that fall squarely within ${journal}'s editorial focus. The methodology and findings we present contribute meaningfully to the body of knowledge that ${journal} seeks to advance, establishing clear connections between our research objectives and the journal's scholarly priorities.

Our manuscript makes several novel contributions to the field. The research addresses an important gap in current understanding, as evidenced by our comprehensive investigation detailed in the abstract. Our methodological approach represents an innovative framework for examining the research problem, employing rigorous analytical techniques that ensure robust and reliable results. The findings reveal significant insights that have important implications for both theoretical advancement and practical applications within the field.

The significance of this work extends beyond its immediate findings. Our research tackles a critical issue that has been identified as a priority area within the relevant academic community. The theoretical framework we develop provides a solid foundation for future research, while the practical implications of our findings offer substantial value to both researchers and practitioners. The comprehensive nature of our analysis ensures depth and breadth that will be particularly valuable to ${journal}'s diverse readership.

The methodological rigor of our study deserves particular emphasis. We employed a carefully designed research approach that addresses key limitations identified in previous studies. Our analytical strategy incorporates multiple validation methods and comprehensive data sources, lending credibility and generalizability to our conclusions. The innovative aspects of our methodology contribute to the field's methodological advancement while ensuring the reliability of our results.

The relevance of this research to ${journal}'s readership cannot be overstated. Scholars working in related fields will find our results directly applicable to their research endeavors. The implications we discuss extend across multiple domains, ensuring broad appeal within the journal's academic community. Our work bridges important theoretical and practical considerations, aligning with ${journal}'s commitment to publishing research that advances both scholarly understanding and real-world applications.

From a practical standpoint, our findings offer actionable insights for relevant stakeholders and practitioners. The evidence-based guidance we provide can inform policy development, professional practice, and decision-making processes. This practical relevance ensures that our manuscript will serve not only the academic community but also professionals working in applied settings, maximizing the impact of the research.

The timing of this submission is particularly opportune, as there is growing interest in this research area within the academic community. Recent developments have highlighted the need for exactly the type of investigation we present. Our manuscript contributes to ongoing scholarly conversations while opening new avenues for future research, positioning ${journal} at the forefront of this evolving field.

Quality assurance has been a central consideration throughout our research process. We have employed rigorous peer review processes, conducted extensive validation studies, and ensured that our methodology meets the highest standards of academic inquiry. This commitment to excellence aligns with ${journal}'s reputation for publishing only the most impactful and methodologically sound research.

In conclusion, we are confident that our manuscript makes a significant contribution to the literature and aligns perfectly with ${journal}'s editorial mission. The research presents novel findings that advance theoretical understanding while offering practical implications for the broader community. We believe that publication in ${journal} would provide the optimal platform for disseminating this important work to the scientific community.

We appreciate your consideration of our manuscript and look forward to your response. Should you require any additional information or clarification during the review process, please do not hesitate to contact me.

Sincerely,

${corresponding}`;
        }

        // Validate form - updated for new fields
        function validateForm() {
            const requiredFields = [
                'title', 'authors', 'corresponding-main', 'affiliation', 'contactEmail',
                'abstract', 'journal', 'editor', 'scope',
                'researchAims', 'keyFindings', 'significance', 'novelty'
            ];
            
            for (let field of requiredFields) {
                const element = document.getElementById(field);
                if (!element || !element.value.trim()) {
                    alert(`Please fill in the required field: ${field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())}`);
                    return false;
                }
            }
            return true;
        }

        // Copy to clipboard
        function copyToClipboard() {
            const output = document.getElementById('output');
            const text = output.textContent;
            
            if (text === 'Your generated cover letter will appear here...') {
                alert('Please generate a cover letter first.');
                return;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = '#28a745';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#28a745';
                }, 2000);
            });
        }

        // Update word count
        function updateWordCount() {
            const text = document.getElementById('output').textContent;
            const words = text.trim().split(/\s+/).filter(word => word.length > 0);
            const count = words.length;
            document.getElementById('wordCount').textContent = `Word count: ${count}`;
        }

        // Show important notice after generation
        function showImportantNotice() {
            const notice = document.getElementById('importantNotice');
            notice.style.display = 'block';
            
            // Smooth scroll to notice after a brief delay
            setTimeout(() => {
                notice.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
            }, 500);
        }
    </script>
</body>
</html>
